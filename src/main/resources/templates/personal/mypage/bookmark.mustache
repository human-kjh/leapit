{{> layout/personal-header}}

            <!-- 본문 -->
            <div class="main container mt-5">
                <div class="content-wrapper">
                    <div class="mypageSidebar">
                        <div class="mypageSidebarBox">
                            <h5 class="mypageSidebarTitle">마이점핏</h5>
                            <div class="mypageSidebarMenu">
                                <a href="/personal/mypage/application" class="mypageSidebarLink">입사지원 현황</a>
                                <a href="/personal/mypage/bookmark" class="mypageSidebarLink">스크랩 포지션</a>
                                <a href="#" class="mypageSidebarLink">계정 정보 설정</a>
                            </div>
                        </div>
                    </div>
                    <div class="myStatus">
                        <div class="myStatusInner">
                            <div class="myStatusTitle">마이 점핏</div>
                            <div class="statusBoxes">
                                <div class="statusBox">
                                    <h6>지원완료</h6>
                                    <span class="statusCount">{{models.status.total}}</span>
                                </div>
                                <div class="statusBox">
                                    <h6>최종합격</h6>
                                    <span class="statusCount">{{models.status.passed}}</span>
                                </div>
                                <div class="statusBox">
                                    <h6>불합격</h6>
                                    <span class="statusCount">{{models.status.failed}}</span>
                                </div>
                            </div>
                        </div>
                        <!-- 스크랩 포지션 목록 -->
                        <div class="scrapedPositionContainer">
                            <h4 class="scrapTitle">나의 스크랩 포지션</h4>
                            <div class="scrapedJobList">
                                {{#models.bookmarks}}
                                    <div class="scrapedJobItem card p-3" style="width: 18rem;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <a href="/job/detail/{{jobPostingId}}" class="flex-grow-1 text-decoration-none text-dark me-2">
                                                <h6 class="mb-0 text-truncate">{{jobPostingTitle}}</h6>
                                            </a>
                                            {{#isBookmarked}}
                                                <i class="bi bi-bookmark-fill fs-5 text-primary"
                                                   id="bookmark-{{jobPostingId}}"
                                                   tabindex="-1"
                                                   style="cursor: pointer;"
                                                   onmousedown="event.preventDefault()"
                                                   onclick="deleteBookmark({{jobPostingId}})"></i>
                                            {{/isBookmarked}}
                                            {{^isBookmarked}}
                                                <i class="bi bi-bookmark-fill fs-5 text-primary"
                                                   id="bookmark-{{jobPostingId}}"
                                                   tabindex="-1"
                                                   style="cursor: pointer;"
                                                   onmousedown="event.preventDefault()"
                                                   onclick="deleteBookmark({{jobPostingId}})"></i>
                                            {{/isBookmarked}}
                                        </div>
                                        <p class="text-muted mb-1 small">{{companyName}}</p>
                                        <div class="date text-muted small">마감일: {{DeadLine}}</div>
                                    </div>
                                {{/models.bookmarks}}

                                {{^models.bookmarks}}
                                    <div class="text-muted">스크랩한 포지션이 없습니다.</div>
                                {{/models.bookmarks}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                async function saveBookmark(jobPostingId) {
                    try {
                        const response = await fetch(`/api/personal/bookmark`, {
                            method: "POST",
                            body: JSON.stringify({ applicationId: jobPostingId }),
                            headers: { "Content-Type": "application/json" }
                        });

                        const result = await response.json();

                        if (result.status === 200) {
                            const icon = document.querySelector(`#bookmark-${jobPostingId}`);
                            icon.classList.remove("fa-star-o");
                            icon.classList.add("fa-star", "text-warning");
                            icon.setAttribute("onclick", `deleteBookmark(${jobPostingId})`);
                        } else {
                            alert(result.msg);
                        }
                    } catch (e) {
                        console.error("스크랩 등록 중 오류:", e);
                    }
                }

                async function deleteBookmark(jobPostingId) {
                    try {
                        const response = await fetch(`/api/personal/bookmark/${jobPostingId}`, {
                            method: "DELETE"
                        });

                        const result = await response.json();

                        if (result.status === 200) {
                            const icon = document.querySelector(`#bookmark-${jobPostingId}`);
                            icon.classList.remove("fa-star", "text-warning");
                            icon.classList.add("fa-star-o");
                            icon.setAttribute("onclick", `saveBookmark(${jobPostingId})`);
                        } else {
                            alert(result.msg);
                        }
                    } catch (e) {
                        console.error("스크랩 삭제 중 오류:", e);
                    }
                }
                function toggleBookmarkFilter() {
                    const form = document.getElementById('bookmarkForm');
                    const input = document.getElementById('isBookmark');
                    const currentValue = input.value;


                    if (currentValue === "true") {
                        input.value = "";
                    } else {
                        input.value = "true";
                    }

                    form.submit();
                }
            </script>
            <!-- 본문 끝 -->

{{> layout/footer}}